<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ABC: A Batching Compiler for FHE: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ABC: A Batching Compiler for FHE
   </div>
   <div id="projectbrief">Optimizing compiler for Fully Homomorphic Encryption</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="fragment"><div class="line">    ___       ____        __       __    _                ______                      _ __         </div>
<div class="line">   /   |     / __ )____ _/ /______/ /_  (_)___  ____ _   / ____/___  ____ ___  ____  (_) /__  _____</div>
<div class="line">  / /| |    / __  / __ `/ __/ ___/ __ \/ / __ \/ __ `/  / /   / __ \/ __ `__ \/ __ \/ / / _ \/ ___/</div>
<div class="line"> / ___ |   / /_/ / /_/ / /_/ /__/ / / / / / / / /_/ /  / /___/ /_/ / / / / / / /_/ / / /  __/ /    </div>
<div class="line">/_/  |_|  /_____/\__,_/\__/\___/_/ /_/_/_/ /_/\__, /   \____/\____/_/ /_/ /_/ .___/_/_/\___/_/     </div>
<div class="line">                                             /____/                        /_/                     </div>
</div><!-- fragment --><p> <a href="https://isocpp.org/"><img src="https://img.shields.io/badge/language-C++-blue.svg" alt="Language" style="pointer-events: none;" class="inline"/></a> <a href="https://en.wikipedia.org/wiki/C%2B%2B#Standardization"><img src="https://img.shields.io/badge/c%2B%2B-11/14/17-blue.svg" alt="CPP_Standard" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/MarbleHE/AST-Optimizer/actions"><img src="https://github.com/MarbleHE/ABC/workflows/build_run_tests/badge.svg" alt="CI/CD" style="pointer-events: none;" class="inline"/></a> <a href="http://marblehe.github.io/ABC"><img src="https://img.shields.io/badge/docs-doxygen-blue.svg" alt="Documentation" style="pointer-events: none;" class="inline"/></a> <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT" style="pointer-events: none;" class="inline"/></a></p>
<p>ABC is an optimizing compiler for Fully Homomorphic Encryption (FHE). FHE allows computation over encrypted data, but imposes a variety of cryptographic and engineering challenges. This compiler translates high-level program descriptions in a C-like language into the circuit-based programming paradigm of FHE. It does so while automating as many aspects of the development as possible, including automatically identifying and exploiting opportunities to use the powerful SIMD parallelism ("batching") present in many schemes.</p>
<ul>
<li><a href="#repositorys-structure">Repository's Structure</a></li>
<li><a href="#compilation">Compilation</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#ast-representation">AST Representation</a></li>
<li><a href="#extending-the-library">Extending the Library</a><ul>
<li><a href="#code-style">Code Style</a></li>
<li><a href="#inspections">Inspections</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#testing">Testing</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md0"></a>
Repository's Structure</h2>
<p>The repository is organized as follow:</p>
<div class="fragment"><div class="line">examples        – simple examples (WIP)</div>
<div class="line">include         – header files (.h)</div>
<div class="line"> └ ast          – classes to represents programs as an AST </div>
<div class="line"> └ parser       – tokenizer and parser</div>
<div class="line"> └ runtime      - the runtime system (execute an AST using an FHE library)</div>
<div class="line"> └ utilities    – utilities for certain tasks on ASTs (e.g., printing in DOT language)</div>
<div class="line"> └ visitor      – various visitors performing optimizations</div>
<div class="line">libs            – files required by CMake to download dependencies</div>
<div class="line">src             – source files (.cpp)</div>
<div class="line"> └ ast</div>
<div class="line"> └ parser</div>
<div class="line"> └ runtime</div>
<div class="line"> └ utilities</div>
<div class="line"> └ visitor</div>
<div class="line">test             – unit tests for all classes</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1"></a>
Compilation</h2>
<p>We include a simple C-like high-level input language, and a parser that translates it into Abstract Syntax Trees (ASTs), which form our intermediate representation (IR).</p>
<p>The compilation itself can be divided into three stages:</p>
<p><b>1. Program Transformations.</b> These AST-to-AST transformations aim to modify the program to make it more "FHE" friendly. These include optimizations common in standard compilers and FHE-specific optimizations like our automated batching optimization.</p>
<p><b>1. AST-to-Circuit Transformations.</b> These transform the AST into a circuit by transforming non-compatible operations (e.g., If- and While-Statements) into their circuit-equivalent using gates. Note that instead of changing to a wires-and-gates IR, circuits are still expressed using (a subset of) the AST IR.</p>
<p><b>3. Circuit-to-Circuit Transformations.</b> These transformations transform a circuit into a semantically equivalent circuit with better performance in FHE. <a class="el" href="class_for.html">For</a> example, by rewriting the circuit to reduce the multiplicative depth. This allows using smaller parameters that, in turn, enable more efficient computation.</p>
<p>Finally, we include a runtime system that can take (circuit-compatible) ASTs and run them against FHE libraries (currently, only Microsoft SEAL is supported) or against a dummy scheme (for faster testing).</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Getting Started</h2>
<p>Before starting, make sure to clone this repository using: </p><div class="fragment"><div class="line">git clone https://github.com/pjattke/msc-thesis-code-AST.git</div>
</div><!-- fragment --><p>The following tools are required to get this project running:</p><ul>
<li>cmake (version ≥ 3.15) to build the project<ul>
<li>tested with v3.15.5</li>
</ul>
</li>
<li>gcc or clang to compile the sources<ul>
<li>tested with Apple clang v11.0.0</li>
</ul>
</li>
<li>doxygen to build the documentation files (html)<ul>
<li>tested with v1.8.16</li>
</ul>
</li>
</ul>
<p>The easiest way to use this library is to import the project into <a href="https://www.jetbrains.com/clion/">CLion</a> which automatically loads the containing cmake build files and adds the respective targets. Development was carried out on macO (10.15.2), although the project should be running on Windows or Linux machines too.</p>
<p>The entire framework is built around ASTs, the nodes of which are implemented by a class hierarchy that derives from <a class="el" href="class_abstract_node.html">AbstractNode</a> (see above). The AST nodes "own" (std::unique_ptr) their children (and, transitively, the entire subgraph).</p>
<p>Our input language is essentially a toy version of C. We have a very simple hand-written parser on-top of a tokenizer (Stork) from another open source project. It takes a string and returns the root node of the generated AST. We also implemented the reverse, allowing us to print an AST back into this language, which is much more human-readable than our "real" intermediate representation (JSON of the AST).</p>
<p>The entire compiler relies heavily on the visitor pattern, and there is some template magic (see <a class="el" href="class_scoped_visitor.html">ScopedVisitor</a>) that allows one to still use overloading in visitors, so one can e.g. handle all AbstractExpressions in one function if the visitor only cares about statements. This is mostly transparent to the developer.</p>
<p>All of our optimizations and transformations are implemented as visitors. Since the visitor pattern doesn't easily allow you to "return" values, we frequently use std::unordered_map&lt;std::string, SOMETHING&gt; , allowing us to associate data with (the unique ID of) an AST node. So when visiting an <a class="el" href="class_if.html">If</a> stmt, we can visit both branches recursively and then get the "return" by looking into the hash_map at the child-nodes' ids.</p>
<p>Finally, our runtime system is also implemented as a visitor. It takes an "AbstractCiphertextFactory", the instantiations of which are basically just super thin wrappers around FHE libraries (currently just SEAL). So if we see a multiplication node in the tree, we just end up calling something like seal::multiply(ctxt a, ctxt b).</p>
<h2><a class="anchor" id="autotoc_md6"></a>
AST Representation</h2>
<p>The AST consists of nodes that are derived from either <code><a class="el" href="class_abstract_expression.html" title="This class merely structures the inheritance hierarchy.">AbstractExpression</a></code> or <code><a class="el" href="class_abstract_statement.html" title="This class merely structures the inheritance hierarchy.">AbstractStatement</a></code>, depending on whether the operation is an expression or a statement, respectively. </p><div class="fragment"><div class="line">                                 ┌─────────────────────┐                                                   </div>
<div class="line">                                 │    AbstractNode     │                                                   </div>
<div class="line">                                 └─────────────────────┘                                                   </div>
<div class="line">                                            ▲                                                              </div>
<div class="line">                                            │                                                              </div>
<div class="line">                                            │                                                              </div>
<div class="line">                ┌─────────────────────┐     │     ┌─────────────────────┐                                  </div>
<div class="line">                │  AbstractStatement  │─────┴─────│ AbstractExpression  │                                  </div>
<div class="line">                └─────────────────────┘           └─────────────────────┘                                  </div>
<div class="line">                           ▲                                 ▲                                             </div>
<div class="line">┌─────────────────────┐    │                                 │     ┌─────────────────────┐                 </div>
<div class="line">│     Assignment      │────┤                                 ├─────│   AbstractTarget    │                 </div>
<div class="line">└─────────────────────┘    │                                 │     └─────────────────────┘                 </div>
<div class="line">                           │                                 │                ▲                            </div>
<div class="line">┌─────────────────────┐    │                                 │                │     ┌─────────────────────┐</div>
<div class="line">│        Block        │────┤                                 │                ├─────│  FunctionParameter  │</div>
<div class="line">└─────────────────────┘    │                                 │                │     └─────────────────────┘</div>
<div class="line">                           │                                 │                │                            </div>
<div class="line">┌─────────────────────┐    │                                 │                │     ┌─────────────────────┐</div>
<div class="line">│         For         │────┤                                 │                ├─────│     IndexAccess     │</div>
<div class="line">└─────────────────────┘    │                                 │                │     └─────────────────────┘</div>
<div class="line">                           │                                 │                │                            </div>
<div class="line">┌─────────────────────┐    │                                 │                │     ┌─────────────────────┐</div>
<div class="line">│      Function       │────┤                                 │                └─────│      Variable       │</div>
<div class="line">└─────────────────────┘    │                                 │                      └─────────────────────┘</div>
<div class="line">                           │                                 │                                             </div>
<div class="line">┌─────────────────────┐    │                                 │     ┌─────────────────────┐                 </div>
<div class="line">│         If          │────┤                                 ├─────│  BinaryExpression   │                 </div>
<div class="line">└─────────────────────┘    │                                 │     └─────────────────────┘                 </div>
<div class="line">                           │                                 │                                             </div>
<div class="line">┌─────────────────────┐    │                                 │     ┌─────────────────────┐                 </div>
<div class="line">│       Return        │────┤                                 ├─────│ OperatorExpression  │                 </div>
<div class="line">└─────────────────────┘    │                                 │     └─────────────────────┘                 </div>
<div class="line">                           │                                 │                                             </div>
<div class="line">┌─────────────────────┐    │                                 │     ┌─────────────────────┐                 </div>
<div class="line">│ VariableDeclaration │────┘                                 ├─────│   UnaryExpression   │                 </div>
<div class="line">└─────────────────────┘                                      │     └─────────────────────┘                 </div>
<div class="line">                                                             │                                             </div>
<div class="line">                                                             │     ┌─────────────────────┐                 </div>
<div class="line">                                                             ├─────│        Call         │                 </div>
<div class="line">                                                             │     └─────────────────────┘                 </div>
<div class="line">                                                             │                                             </div>
<div class="line">                                                             │     ┌─────────────────────┐                 </div>
<div class="line">                                                             ├─────│   ExpressionList    │                 </div>
<div class="line">                                                             │     └─────────────────────┘                 </div>
<div class="line">                                                             │                                             </div>
<div class="line">                                                             │     ┌─────────────────────┐                 </div>
<div class="line">                                                             ├─────│     Literal&lt;T&gt;      │                 </div>
<div class="line">                                                             │     └─────────────────────┘                 </div>
<div class="line">                                                             │                                             </div>
<div class="line">                                                             │     ┌─────────────────────┐                 </div>
<div class="line">                                                             └─────│   TernaryOperator   │                 </div>
<div class="line">                                                                   └─────────────────────┘                 </div>
</div><!-- fragment --><p><em><b>Figure 1:</b></em> Class hierarchy of the AST classes.</p>
<p>Following, the different node types are briefly explained. The examples in brackets show how the commands would look like in "plain" C++.</p>
<ul>
<li>Classes derived from <code><a class="el" href="class_abstract_expression.html" title="This class merely structures the inheritance hierarchy.">AbstractExpression</a></code><ul>
<li><code>BinaryExpr</code> – a binary arithmetic expression (e.g., <code>13 + 37</code>).</li>
<li><code><a class="el" href="class_call.html">Call</a></code> – a call to an internal function, i.e., its implementation is represented in the AST as a <a class="el" href="class_function.html" title="A function has a return type, name, a list of parameters and a body.">Function</a>.</li>
<li><code><a class="el" href="class_function_parameter.html">FunctionParameter</a></code> – describes the parameters that a function accepts. To evaluate an AST, values must be passed for each of the parameter defined by the function's <code><a class="el" href="class_function_parameter.html">FunctionParameter</a></code> node.</li>
<li><code><a class="el" href="class_literal.html" title="Literals contain a scalar value (of type bool, char, int, float, double, string, etc)">Literal</a></code> – base class for all <a class="el" href="class_literal.html" title="Literals contain a scalar value (of type bool, char, int, float, double, string, etc)">Literal</a> derived from.</li>
<li><code>LiteralBool</code> – models a Boolean value.</li>
<li><code>LiteralInt</code> – models an integer value.</li>
<li><code>LiteralString</code> – models an string value.</li>
<li><code>LiteralFloat</code> – models a float value.</li>
<li><code>LogicalExpr</code> – a (binary) logical expression using a logical operator (e.g., <code>z &lt; 42</code>).</li>
<li><code>UnaryExpr</code> – a unary expression (e.g., <code>!b</code> where <code>b</code> is a Boolean).</li>
<li><code><a class="el" href="class_variable.html">Variable</a></code> – a variable identified by an identifier (name).</li>
</ul>
</li>
<li>Classes derived from <code><a class="el" href="class_abstract_statement.html" title="This class merely structures the inheritance hierarchy.">AbstractStatement</a></code><ul>
<li><code><a class="el" href="class_block.html">Block</a></code> – a code block <code>{...}</code>, e.g., the then-clause of an if statement.</li>
<li><code><a class="el" href="class_function.html" title="A function has a return type, name, a list of parameters and a body.">Function</a></code> – a function definition.</li>
<li><code><a class="el" href="class_if.html">If</a></code> – an if-conditional statement including both a then-branch and an else-branch (e.g., <code>if (condition) { ... } else { ... }</code>), or either only a then-branch.</li>
<li><code><a class="el" href="class_return.html" title="A Return statement has an (optional) value (AbstractExpression)">Return</a></code> – a return statement of a method (e.g., <code>return</code> ).</li>
<li><code>VarAssignm</code> – the assignment of a variable.</li>
<li><code>VarDecl</code> – a variable declaration (e.g., <code>Z</code>)</li>
<li><code>While</code> – a while-loop (e.g., <code>while (condition) {...}</code>).</li>
<li><code>CallExternal</code> – <em>see above.</em></li>
<li><code><a class="el" href="class_return.html" title="A Return statement has an (optional) value (AbstractExpression)">Return</a></code> – a return statement of a method, i.e., the output of a computation.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
Extending the Library</h2>
<p>In general, PRs are very welcome! However, to ensure that this library keeps a high quality standard, this section introduces some conventions to be followed when extending this library.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Code Style</h3>
<p>The code is written in C++ and formatted according to code style file <a href="MarbleHE_CPP_Code_Style.xml">MarbleHE_CPP_Code_Style.xml</a>. The file can be loaded into the IDE of your choice, for example, in CLion's preferences (Editor → Code Style → C/C++). As the style file can change at any time, please keep in mind to use the latest version before sending a PR.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Inspections</h3>
<p>This codebase was checked against the default C/C++ inspections provided in CLion.</p>
<p>Further, the static code checker <a href="https://github.com/cpplint/cpplint">cpplint</a> is used that provides more advanced checks. It can be integrated into CLion using the <a href="https://plugins.jetbrains.com/plugin/7871-clion-cpplint">CLion-cpplint</a> plugin. To ensure consistency, pleasure use the following settings (to be provided in the plugin's options at Preferences -&gt; cpplint option): </p><div class="fragment"><div class="line">--linelength=120 --filter=-legal/copyright,-build/header_guard,-whitespace/comments,-runtime/references,-whitespace/operators</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md10"></a>
Documentation</h3>
<p><a href="http://www.doxygen.nl/manual/index.html">Doxygen</a> comments are used to create a documentation of this library. The documentation can be generated using the supplied configuration <code>doxygen.conf</code> as described following:</p>
<div class="fragment"><div class="line">doxygen Doxyfile</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md11"></a>
Testing</h3>
<p>The code is covered by unit tests to achieve high code quality and avoid introducing errors while extending the library. <a class="el" href="class_for.html">For</a> that, the <a href="https://github.com/google/googletest">Google Test</a> framework is used. The library as well as any other dependencies are automatically cloned from its GitHub repository using cmake, see <a href="test/CMakeLists.txt">CMakeLists.txt</a>.</p>
<p>The tests can be found in the [<code>test</code>](test) directory and are named according to the class file that the test covers (e.g., <code>MultDepthVisitorTest</code> for the test covering the <code>MultDepthVisitor</code> class).</p>
<p>It is required to submit tests for newly added features to ensure correctness and avoid breaking the feature by future changes (regression test). Any PRs without tests will not be considered to be integrated.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
Workflow</h3>
<p>This project uses <a href="https://guides.github.com/introduction/flow/">GitHub flow</a>, i.e. all work around an improvement/feature happens on a specific branch and is only merged into main once it passes all checks and has been reviewed.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
References</h2>
<p>[1] Viand, A., Shafagh, H.: <a href="http://www.vs.inf.ethz.ch/publ/papers/vianda_marble_2018.pdf">Marble: Making Fully Homomorphic Encryption Accessible to All.</a> In: Proceedings of the 6th workshop on encrypted computing &amp; applied homomorphic cryptography. pp. 49–60 (2018).</p>
<p>[2] Aubry, P. et al.: <a href="https://eprint.iacr.org/2019/963.pdf">Faster Homomorphic Encryption Is Not Enough: Improved Heuristic for Multiplicative Depth Minimization of Boolean Circuits.</a> (2019). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
